<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>git with multiple users | Andrey Nautilus blog</title>
<meta name=keywords content="git,gitconfig,ssh,gpg"><meta name=description content="'includeIf' in gitconfig; and ssh client configuration"><meta name=author content><link rel=canonical href=https://andreynautilus.github.io/posts/02-git-multiple-users/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://andreynautilus.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://andreynautilus.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://andreynautilus.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://andreynautilus.github.io/apple-touch-icon.png><link rel=mask-icon href=https://andreynautilus.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://andreynautilus.github.io/posts/02-git-multiple-users/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="git with multiple users"><meta property="og:description" content="'includeIf' in gitconfig; and ssh client configuration"><meta property="og:type" content="article"><meta property="og:url" content="https://andreynautilus.github.io/posts/02-git-multiple-users/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-05-22T20:24:48+02:00"><meta property="article:modified_time" content="2024-05-22T20:24:48+02:00"><meta property="og:site_name" content="Andrey Nautilus blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="git with multiple users"><meta name=twitter:description content="'includeIf' in gitconfig; and ssh client configuration"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://andreynautilus.github.io/posts/"},{"@type":"ListItem","position":2,"name":"git with multiple users","item":"https://andreynautilus.github.io/posts/02-git-multiple-users/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"git with multiple users","name":"git with multiple users","description":"'includeIf' in gitconfig; and ssh client configuration","keywords":["git","gitconfig","ssh","gpg"],"articleBody":"Multiple users Quite often we need to have multiple git users on the same workstation. For example:\na user for working account; a user for personal account; These users should have different name and email, and might need different configuration and authentication. Accounts for the users can be on different platforms (GitHub, GitLab, BitBucket etc) or on the same.\nA simple solution would be to use repository-local (git config --local) configuration, but this means repeating it over and over again for every cloned repository. This is not an engineers way.\nConfigure git per directory Git stores global configuration in ~/.gitconfig file. It’s a text file which supports conditional includes via includeIf directive. We’re interested in gitdir condition, which includes the file if the current repository (.git folder of the current repository) is in the specified directory.\nSo, we can nicely isolate all work-related repositories in ~/work directory and all personal repositories in ~/peronal directory. For example, the main ~/.gitconfig file may look like:\n[user] name = Alex Green email = alex.green@company.com [includeIf \"gitdir:~/work/\"] path = ~/.gitconfig-work [includeIf \"gitdir:~/personal/\"] path = ~/.gitconfig-personal while ~/.gitconfig-work enables commit signing for work account:\n[user] signingkey = XXXXXXX [gpg] program = gpg [commit] gpgsign = true and ~/.gitconfig-personal redefines user name and email for personal account:\n[user] name = Mr Green email = mr-green@personal.com See:\n~/work/company-project $ git config --get user.name Alex Green ~/personal/awesome-project $ git config --get user.name Mr Green ssh authentication Most git platforms (GitHub, GitLab, BitBucket etc) support ssh authentication, and we can configure it in ~/.ssh/config file of our ssh client:\nHost github.com IdentityFile ~/.ssh/github Host bitbucket.com IdentityFile ~/.ssh/bitbucket Then both\ngit clone git@github.com:organization/repository.git git clone git@bitbucket.org:organization/repository.git work and use corresponding ssh keys.\nssh authnetication for the same host But what if we have multiple accounts on the same platform (both accounts are on GitHub for example)? Well, ssh client doesn’t know which key to use, so we need to tell it via different host. We can configure the ssh client with artificial host for one of the accounts (for example for personal account):\nHost github.com-personal IdentityFile ~/.ssh/github-personal Host github.com IdentityFile ~/.ssh/github-work Then git clone git@github.com:organization/repository.git will use ~/.ssh/github-work key.\nBut in order to clone a repository using personal ~/.ssh/github-personal key, we need to change the host in url manually (note github.com-personal instead of github.com):\ngit clone git@github.com-personal:organization/repository.git This means we can’t use the “default” clone command provided by the platform, we need to manually adjust it.\nHint: it’s generally more convenient to have the “default” configuration for the account which is used to clone repositories more often, because we can use the “default” clone command from the platform.\nSome references:\nhttps://stackoverflow.com/questions/67593657/setting-up-multiple-ssh-key-access-to-github https://gist.github.com/alejandro-martin/aabe88cf15871121e076f66b65306610 using core.sshCommand config option (or GIT_SSH_COMMAND environment variable) it’s possible to distinguish ssh keys based on current folder; Commit signing Some platforms may require commit signing. I use gpg key for that. GitHub documentation explains how to set it up. We can also configure git to sign our commits by default:\n[user] signingkey = XXXXXXX [gpg] program = gpg [commit] gpgsign = true ","wordCount":"505","inLanguage":"en","datePublished":"2024-05-22T20:24:48+02:00","dateModified":"2024-05-22T20:24:48+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://andreynautilus.github.io/posts/02-git-multiple-users/"},"publisher":{"@type":"Organization","name":"Andrey Nautilus blog","logo":{"@type":"ImageObject","url":"https://andreynautilus.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://andreynautilus.github.io/ accesskey=h title="Andrey Nautilus blog (Alt + H)"><img src=https://andreynautilus.github.io/apple-touch-icon.png alt aria-label=logo height=35>Andrey Nautilus blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://andreynautilus.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://andreynautilus.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://github.com/AndreyNautilus/AndreyNautilus.github.io title=src><span>src</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://andreynautilus.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://andreynautilus.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">git with multiple users</h1><div class=post-description>'includeIf' in gitconfig; and ssh client configuration</div><div class=post-meta><span title='2024-05-22 20:24:48 +0200 +0200'>May 22, 2024</span>&nbsp;·&nbsp;3 min</div></header><div class=post-content><h2 id=multiple-users>Multiple users<a hidden class=anchor aria-hidden=true href=#multiple-users>#</a></h2><p>Quite often we need to have multiple git users on the same workstation. For example:</p><ul><li>a user for working account;</li><li>a user for personal account;</li></ul><p>These users should have different name and email, and might need different configuration and authentication.
Accounts for the users can be on different platforms (GitHub, GitLab, BitBucket etc) or on the same.</p><p>A simple solution would be to use repository-local (<code>git config --local</code>) configuration,
but this means <em>repeating it over and over again for every cloned repository</em>.
This is not an engineers way.</p><h2 id=configure-git-per-directory>Configure git per directory<a hidden class=anchor aria-hidden=true href=#configure-git-per-directory>#</a></h2><p>Git stores global configuration in <code>~/.gitconfig</code> <a href=https://git-scm.com/docs/git-config#_configuration_file>file</a>.
It&rsquo;s a text file which supports <a href=https://git-scm.com/docs/git-config#_conditional_includes>conditional includes</a> via <code>includeIf</code> directive.
We&rsquo;re interested in <code>gitdir</code> condition, which includes the file if the current repository
(<code>.git</code> folder of the current repository) is in the specified directory.</p><p>So, we can nicely isolate all work-related repositories in <code>~/work</code> directory and all personal repositories in <code>~/peronal</code> directory.
For example, the main <code>~/.gitconfig</code> file may look like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[user]</span>
</span></span><span class=line><span class=cl>    <span class=na>name</span> <span class=o>=</span> <span class=s>Alex Green
</span></span></span><span class=line><span class=cl><span class=s>    email = alex.green@company.com</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[includeIf &#34;gitdir:~/work/&#34;]</span>
</span></span><span class=line><span class=cl>    <span class=na>path</span> <span class=o>=</span> <span class=s>~/.gitconfig-work</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[includeIf &#34;gitdir:~/personal/&#34;]</span>
</span></span><span class=line><span class=cl>    <span class=na>path</span> <span class=o>=</span> <span class=s>~/.gitconfig-personal</span>
</span></span></code></pre></div><p>while <code>~/.gitconfig-work</code> enables commit signing for work account:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[user]</span>
</span></span><span class=line><span class=cl>    <span class=na>signingkey</span> <span class=o>=</span> <span class=s>XXXXXXX</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[gpg]</span>
</span></span><span class=line><span class=cl>    <span class=na>program</span> <span class=o>=</span> <span class=s>gpg</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[commit]</span>
</span></span><span class=line><span class=cl>    <span class=na>gpgsign</span> <span class=o>=</span> <span class=s>true</span>
</span></span></code></pre></div><p>and <code>~/.gitconfig-personal</code> redefines user name and email for personal account:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[user]</span>
</span></span><span class=line><span class=cl>    <span class=na>name</span> <span class=o>=</span> <span class=s>Mr Green
</span></span></span><span class=line><span class=cl><span class=s>    email = mr-green@personal.com</span>
</span></span></code></pre></div><p>See:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>~/work/company-project $ git config --get user.name
</span></span></span><span class=line><span class=cl><span class=go>Alex Green
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>~/personal/awesome-project $ git config --get user.name
</span></span></span><span class=line><span class=cl><span class=go>Mr Green
</span></span></span></code></pre></div><h2 id=ssh-authentication>ssh authentication<a hidden class=anchor aria-hidden=true href=#ssh-authentication>#</a></h2><p>Most git platforms (<a href=https://docs.github.com/en/authentication/connecting-to-github-with-ssh>GitHub</a>,
<a href=https://docs.gitlab.com/ee/user/ssh.html>GitLab</a>, BitBucket etc) support ssh authentication, and we can configure it
in <code>~/.ssh/config</code> <a href=https://www.ssh.com/academy/ssh/config>file</a> of our ssh client:</p><pre tabindex=0><code>Host github.com
  IdentityFile ~/.ssh/github

Host bitbucket.com
  IdentityFile ~/.ssh/bitbucket
</code></pre><p>Then both</p><ul><li><code>git clone git@github.com:organization/repository.git</code></li><li><code>git clone git@bitbucket.org:organization/repository.git</code></li></ul><p>work and use corresponding ssh keys.</p><h3 id=ssh-authnetication-for-the-same-host>ssh authnetication for the same host<a hidden class=anchor aria-hidden=true href=#ssh-authnetication-for-the-same-host>#</a></h3><p>But what if we have multiple accounts on the same platform (both accounts are on GitHub for example)?
Well, ssh client doesn&rsquo;t know which key to use, so we need to tell it via different <em>host</em>.
We can configure the ssh client with artificial host for one of the accounts (for example for personal account):</p><pre tabindex=0><code>Host github.com-personal
  IdentityFile ~/.ssh/github-personal

Host github.com
  IdentityFile ~/.ssh/github-work
</code></pre><p>Then <code>git clone git@github.com:organization/repository.git</code> will use <code>~/.ssh/github-work</code> key.</p><p>But in order to clone a repository using personal <code>~/.ssh/github-personal</code> key, we need to change the host in url <em>manually</em>
(note <strong><code>github.com-personal</code></strong> instead of <code>github.com</code>):</p><pre tabindex=0><code>git clone git@github.com-personal:organization/repository.git
</code></pre><p>This means we can&rsquo;t use the &ldquo;default&rdquo; clone command
provided by the platform, we need to <em>manually</em> adjust it.</p><p><strong>Hint</strong>: it&rsquo;s generally more convenient to have the &ldquo;default&rdquo; configuration for the account
which is used to clone repositories more often, because we can use the &ldquo;default&rdquo; clone command from the platform.</p><p>Some references:</p><ul><li><a href=https://stackoverflow.com/questions/67593657/setting-up-multiple-ssh-key-access-to-github>https://stackoverflow.com/questions/67593657/setting-up-multiple-ssh-key-access-to-github</a></li><li><a href=https://gist.github.com/alejandro-martin/aabe88cf15871121e076f66b65306610>https://gist.github.com/alejandro-martin/aabe88cf15871121e076f66b65306610</a></li><li>using <code>core.sshCommand</code> <a href=https://git-scm.com/docs/git-config#Documentation/git-config.txt-coresshCommand>config option</a>
(or <code>GIT_SSH_COMMAND</code> environment variable) it&rsquo;s <a href=https://stackoverflow.com/questions/78419810/using-git-ssh-command-to-switch-ssh-key-based-on-current-working-directory>possible</a> to distinguish ssh keys based on current folder;</li></ul><h2 id=commit-signing>Commit signing<a hidden class=anchor aria-hidden=true href=#commit-signing>#</a></h2><p>Some platforms may require commit signing. I use gpg key for that.
<a href=https://docs.github.com/en/authentication/managing-commit-signature-verification/about-commit-signature-verification>GitHub documentation</a>
explains how to set it up. We can also configure git to sign our commits by default:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[user]</span>
</span></span><span class=line><span class=cl>    <span class=na>signingkey</span> <span class=o>=</span> <span class=s>XXXXXXX</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[gpg]</span>
</span></span><span class=line><span class=cl>    <span class=na>program</span> <span class=o>=</span> <span class=s>gpg</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[commit]</span>
</span></span><span class=line><span class=cl>    <span class=na>gpgsign</span> <span class=o>=</span> <span class=s>true</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://andreynautilus.github.io/tags/git/>Git</a></li><li><a href=https://andreynautilus.github.io/tags/gitconfig/>Gitconfig</a></li><li><a href=https://andreynautilus.github.io/tags/ssh/>Ssh</a></li><li><a href=https://andreynautilus.github.io/tags/gpg/>Gpg</a></li></ul><nav class=paginav><a class=next href=https://andreynautilus.github.io/posts/01-git-force-vs-force-with-lease/><span class=title>Next »</span><br><span>git push --force vs --force-with-lease</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://andreynautilus.github.io/>Andrey Nautilus blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>
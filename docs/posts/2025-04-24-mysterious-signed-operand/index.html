<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Mysterious signed operand in a C++ expression | Andrey Nautilus blog</title><meta name=keywords content="C++"><meta name=description content="Integral promotion in action"><meta name=author content><link rel=canonical href=https://andreynautilus.github.io/posts/2025-04-24-mysterious-signed-operand/><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=https://andreynautilus.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://andreynautilus.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://andreynautilus.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://andreynautilus.github.io/apple-touch-icon.png><link rel=mask-icon href=https://andreynautilus.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://andreynautilus.github.io/posts/2025-04-24-mysterious-signed-operand/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=text/javascript>(function(e,t,n,s,o,i,a){e[o]=e[o]||function(){(e[o].a=e[o].a||[]).push(arguments)},e[o].l=1*new Date;for(var r=0;r<document.scripts.length;r++)if(document.scripts[r].src===s)return;i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://mc.yandex.ru/metrika/tag.js","ym"),ym(99367858,"init",{clickmap:!0,trackLinks:!0,accurateTrackBounce:!0})</script><noscript><div><img src=https://mc.yandex.ru/watch/99367858 style=position:absolute;left:-9999px alt></div></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-S584PB390B"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-S584PB390B")</script><style>.card-tags{font-size:12px}.card-tags span{background:var(--code-bg);border-radius:999px;padding:0 .7em;display:inline-block}</style><meta property="og:url" content="https://andreynautilus.github.io/posts/2025-04-24-mysterious-signed-operand/"><meta property="og:site_name" content="Andrey Nautilus blog"><meta property="og:title" content="Mysterious signed operand in a C++ expression"><meta property="og:description" content="Integral promotion in action"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-04-24T19:09:05+02:00"><meta property="article:modified_time" content="2025-04-24T19:09:05+02:00"><meta property="article:tag" content="C++"><meta name=twitter:card content="summary"><meta name=twitter:title content="Mysterious signed operand in a C++ expression"><meta name=twitter:description content="Integral promotion in action"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"posts","item":"https://andreynautilus.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Mysterious signed operand in a C++ expression","item":"https://andreynautilus.github.io/posts/2025-04-24-mysterious-signed-operand/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Mysterious signed operand in a C++ expression","name":"Mysterious signed operand in a C\u002b\u002b expression","description":"Integral promotion in action","keywords":["C++"],"articleBody":"I came across the following piece of C++ code:\nconst std::uint8_t mask = 0x06; std::uint8_t value = foo(); if (mask \u0026 ~value) { // do something } and SonarQube scan emitted a warning for this code:\nif (mask \u0026 ~value) { ^~~~~~~~~~~~~ Do not apply \"\u0026\" bitwise operator to a signed operand. But, both mask and value are unsigned, so where does the signed operand come from?\nIntegral promotion C++ language allows implicit conversion of integral types in some cases, this is called Integral promotion:\nprvalues of small integral types (such as char) and unscoped enumeration types may be converted to prvalues of larger integral types (such as int). In particular, arithmetic operators do not accept types smaller than int as arguments, and integral promotions are automatically applied after lvalue-to-rvalue conversion, if applicable. This conversion always preserves the value.\nAnd bitwise NOT - ~ - is an arithmetic operator, so it will involve integral promotion:\nIf the operand passed to a built-in arithmetic operator is integral or unscoped enumeration type, then before any other action (but after lvalue-to-rvalue conversion, if applicable), the operand undergoes integral promotion.\nSo, that’s what happens:\nvalue is promoted to int; bitwise ~ operator is applied to value producing int; mask is promoted to int; bitwise \u0026 operator is called with two ints; That’s where signed operand comes from.\nInterestingly, explicit cast of ~value to std::uint8_t via static_cast(~value) silences the SonarQube warning (but does not remove the promotion).\nCompiler Explorer gives the expected result:\nsizeof(value)=1 sizeof(~value)=4 sizeof(mask \u0026 ~value)=4 typeid(~value)=i So, be careful with arithmetic operators when applied to “small” integer types.\n","wordCount":"266","inLanguage":"en","datePublished":"2025-04-24T19:09:05+02:00","dateModified":"2025-04-24T19:09:05+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://andreynautilus.github.io/posts/2025-04-24-mysterious-signed-operand/"},"publisher":{"@type":"Organization","name":"Andrey Nautilus blog","logo":{"@type":"ImageObject","url":"https://andreynautilus.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://andreynautilus.github.io/ accesskey=h title="Andrey Nautilus blog (Alt + H)"><img src=https://andreynautilus.github.io/apple-touch-icon.png alt aria-label=logo height=35>Andrey Nautilus blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://andreynautilus.github.io/links/ title=links><span>links</span></a></li><li><a href=https://andreynautilus.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://andreynautilus.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://github.com/AndreyNautilus/AndreyNautilus.github.io title=src><span>src</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://andreynautilus.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://andreynautilus.github.io/posts/>posts</a></div><h1 class="post-title entry-hint-parent">Mysterious signed operand in a C++ expression</h1><div class=post-meta><span title='2025-04-24 19:09:05 +0200 +0200'>April 24, 2025</span>&nbsp;·&nbsp;2 min</div></header><div class=post-content><p>I came across the following piece of C++ code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl>    <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=kt>uint8_t</span> <span class=n>mask</span> <span class=o>=</span> <span class=mh>0x06</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=kt>uint8_t</span> <span class=n>value</span> <span class=o>=</span> <span class=n>foo</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>mask</span> <span class=o>&amp;</span> <span class=o>~</span><span class=n>value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// do something
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span></code></pre></div><p>and SonarQube scan emitted <a href=https://rules.sonarsource.com/cpp/tag/bad-practice/RSPEC-874/>a warning</a>
for this code:</p><pre tabindex=0><code>    if (mask &amp; ~value) {
        ^~~~~~~~~~~~~
        Do not apply &#34;&amp;&#34; bitwise operator to a signed operand.
</code></pre><p>But, both <code>mask</code> and <code>value</code> are unsigned, so where does the <em>signed</em> operand come from?</p><h2 id=integral-promotion>Integral promotion<a hidden class=anchor aria-hidden=true href=#integral-promotion>#</a></h2><p>C++ language allows implicit conversion of integral types in some cases,
this is called <a href=https://en.cppreference.com/w/cpp/language/implicit_conversion#Integral_promotion>Integral promotion</a>:</p><blockquote><p>prvalues of small integral types (such as char) and unscoped enumeration types may be converted to
prvalues of larger integral types (such as int). In particular,
<a href=https://en.cppreference.com/w/cpp/language/operator_arithmetic>arithmetic operators</a> do not accept types
smaller than int as arguments, and integral promotions are automatically applied after lvalue-to-rvalue conversion,
if applicable. This conversion always preserves the value.</p></blockquote><p>And <em>bitwise NOT</em> - <code>~</code> - is an <a href=https://en.cppreference.com/w/cpp/language/operator_arithmetic>arithmetic operator</a>,
so it will involve integral promotion:</p><blockquote><p>If the operand passed to a built-in arithmetic operator is integral or unscoped enumeration type,
then before any other action (but after lvalue-to-rvalue conversion, if applicable), the operand undergoes integral promotion.</p></blockquote><p>So, that&rsquo;s what happens:</p><ol><li><code>value</code> is promoted to <code>int</code>;</li><li>bitwise <code>~</code> operator is applied to <code>value</code> producing <code>int</code>;</li><li><code>mask</code> is promoted to <code>int</code>;</li><li>bitwise <code>&</code> operator is called with two ints;</li></ol><p>That&rsquo;s where signed operand comes from.</p><p>Interestingly, explicit cast of <code>~value</code> to <code>std::uint8_t</code> via <code>static_cast&lt;std::uint8_t>(~value)</code> silences the SonarQube warning
(but does not remove the promotion).</p><p><a href=https://godbolt.org/#z:OYLghAFBqd5QCxAYwPYBMCmBRdBLAF1QCcAaPECAMzwBtMA7AQwFtMQByARg9KtQYEAysib0QXACx8BBAKoBnTAAUAHpwAMvAFYTStJg1DIApACYAQuYukl9ZATwDKjdAGFUtAK4sGIAMzSrgAyeAyYAHI%2BAEaYxBIAbKQADqgKhE4MHt6%2BAdKp6Y4CoeFRLLHxXEl2mA6ZQgRMxATZPn6Btpj2RQwNTQQlkTFxibaNza25HQrjA2FD5SNVAJS2qF7EyOwc5v5hyN5YANQm/m7IM/iCp9gmGgCCu/uHmCdnTjPEmKw3d48PlxAIC8YQIAA4APoEI78VAQZYnADsVgeRzRRy%2BBA2DCOGlOKMeiIAIn8/qCjiwmGF4UiCeijmgGDMjoDgaDIdDKQoANZvIm41QaBL4v701kgwQco4ANzEXlep35sPhIoeovRrLQXmhpzcupOZjM6QAXphUFQILLvJhlorzGY3nqziy8KbzZa5TbHfrWa5aKr7mKCOggVqdWd9faTWaLQA/K3y23%2BEmG73O6Pu%2BOehG6n3BoF%2BgNBkModbhp1uA1G10xiBc3nmBJHLPWpMph259M1931g1NluJtOV30MdD%2B/wE9VozVlodVggAT2SmDw6AgA5tdtTncri%2BXq/XCZtADpmGwaTuWfmQIWJ6TUejMdjcQGTMSOKtaJwAKy8PwcLRSFQTg9UsawWXWTYFTMfweFIAhNA/VZuRABJ/GPb9EUNBJEQATjMDQNFwyRCKSL8OEkP9EKAzheAUEANHgxDVjgWAYEQG9VFqbUSHISgmmABRlEMLohAQVAAHd/zgtAWGSOgmB6YTwloMTJP/QDZPk%2Bh4mAKQzFILS6DiCJWG2XgjJ0gB5bU1Kk6jMC45B7mIQTaNIRzagaK53P4QQRDEdgpBkQRFBUdQAJ0PQDCMFBrGsfQ8GiejIFWVBkh6eiOAAWkuRVTDAywuERXhUGlOJiFXTAUvhUhiC8QQ8DYAAVVBPBq1YFEgrY9EuMJlNE8T7O4XgJOIJhkk4HhPx/KjIpojhsCcnjiCOVQwQSbKEkkI5gGQZAjikY8HQgUCrEsUgjlwQgSANWDll4BDIuWZCJEI/ROEo0gWBASRv2OnDcO/MEgaIhJ8K4UgNNK9z6MYp6tBY9iICQTzkBWviIAEoSRNUobpIs1A5IUpTcbs6HDKJ7SRgOQw9NwrhGMskyzPc5niBs4R8YcpyXLcjheDR7ywl82QAvEYK/PkJQ1Go3QDJi4x4ou2gko6oCMsyLLcuDfLlYsYrSvK4hKqwdX6salq2todWuo2HrIb6hgBrx9SptG8bJpGmaOF/KHqOAxblqIVb1s27aGUVw7cOPLhjw0I5Tv1y7rpDu6uAepjntWBBviweJapQxnGPIr6fu/SRj0RfwCMkRnJFwjR/A0PD/fmwO6IYrPEde/wEmPSQzERauCLwxvv1w4iPo4fw5sAjvu6Q6ezDnmGBcXl7SGN9JnEkIA%3D%3D>Compiler Explorer</a>
gives the expected result:</p><pre tabindex=0><code>sizeof(value)=1
sizeof(~value)=4
sizeof(mask &amp; ~value)=4
typeid(~value)=i
</code></pre><p>So, be careful with arithmetic operators when applied to &ldquo;small&rdquo; integer types.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://andreynautilus.github.io/tags/c++/>C++</a></li></ul><nav class=paginav><a class=prev href=https://andreynautilus.github.io/posts/2025-05-01-covariant-return-types/><span class=title>« Prev</span><br><span>Covariant types in C++ virtual methods</span>
</a><a class=next href=https://andreynautilus.github.io/posts/2024-12-28-unordered-set-xcode/><span class=title>Next »</span><br><span>Unspecified behaviour in std::unordered_set and MacOS SDK</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://andreynautilus.github.io/>Andrey Nautilus blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>
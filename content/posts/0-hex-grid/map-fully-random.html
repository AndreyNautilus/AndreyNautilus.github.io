<p>
<canvas id="map-fully-random" width="700" height="500"></canvas>
<script>
function generateInitialPoints_random(grid, amount) {
    // Generate random not-equal points

    let result = [];
    for (let i = 0; i < amount; ++i) {
        let point = randomIntPoint(grid.rows_count, grid.cols_count);
        while (result.find((p) => point.equals(p)) != undefined) {
            // re-generate in case of duplicates
            point = randomIntPoint(grid.rows_count, grid.cols_count);
        }
        result.push(point);
    }
    return result;
}

function generateMap_random(grid, number_of_areas) {
    // Fully random generation:
    // - pick random area to expand
    // - expand it to random neighbor

    // generate starting points
    let areas = [];  // list of "list of points + color_index"
    const initialPoints = generateInitialPoints_random(grid, number_of_areas);
    initialPoints.forEach((p, idx) => {
        areas.push([[p, idx]]);
        grid.setCell(p, idx);
    });

    // apply flood fill
    let expandable_points_count = areas.reduce((acc, points) => acc + points.length, 0)
    while (expandable_points_count > 0) {
        // choose area
        const area_idx = randomInt(areas.length);
        let area = areas[area_idx];

        // pick point in the area to expand
        let point_idx = Math.floor(area.length * Math.random());
        const [point, color_idx] = area[point_idx];
        let candidates = grid.getCandidates(point);
        const cand = candidates[randomInt(candidates.length)];
        area.push([cand, color_idx]);
        grid.setCell(cand, color_idx);

        // clean up points and areas
        // TODO: very inefficient, but works
        areas = areas
            .map((area) => area.filter(([point, color_idx]) => grid.getCandidates(point).length > 0))
            .filter((area) => area.length > 0);

        expandable_points_count = areas.reduce((acc, points) => acc + points.length, 0);
    }

    return initialPoints;
}

function generateAndRenderMap_fully_random() {
    const canvas = document.getElementById("map-fully-random");

    const cell_radius = 5;
    const cell_diameter = 2 * cell_radius;

    // construct grid
    const cols_count = Math.floor((canvas.width - cell_radius) / cell_diameter);
    const rows_count = Math.floor(canvas.height / cell_diameter);
    let grid = new HexGrid(rows_count, cols_count);

    // generate random map
    const initialPoints = generateMap_random(grid, colors.length);

    // draw map
    renderGrid(canvas, grid, initialPoints, colors, cell_radius);
}

document.getElementById("map-fully-random").addEventListener('click', generateAndRenderMap_fully_random);
generateAndRenderMap_fully_random();

</script>
</p>
